<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script type="module">
      document.addEventListener("DOMContentLoaded", async () => {
        const alertMessage = document.getElementById("alertMessage");
        const videoUrlInput = document.getElementById("videoUrlInput");
        const fetchFormatsButton =
          document.getElementById("fetchFormatsButton");
        const videoIdDisplay = document.getElementById("videoIdDisplay");
        const videoFormatsDisplay = document.getElementById(
          "videoFormatsDisplay",
        );

        fetchFormatsButton.addEventListener("click", async () => {
          if (!videoUrlInput.value) {
            alertMessage.innerText = "Please enter a URL";
            return;
          }
          if (videoUrlInput.value.trim() === "") {
            alertMessage.innerText = "Please enter a valid URL";
            return;
          }
          const videoId = videoUrlInput.value.split("v=")[1];
          if (!videoId || videoId.includes("&")) {
            alertMessage.innerText = "Invalid URL";
            return;
          }
          alertMessage.innerText = "Fetching formats...";
          videoIdDisplay.innerText = videoId;
          const videoFormats = await fetch(
            `http://localhost:3000/youtube/${videoId}/info/formats`,
          );
          const formatsData = await videoFormats.json();
          videoFormatsDisplay.innerText = JSON.stringify(formatsData);
          alertMessage.innerText = "Formats fetched successfully";
        });
      });
    </script>
  </head>

  <body>
    <div>
      <p id="alertMessage">No alerts</p>
      <input id="videoUrlInput" />
      <button id="fetchFormatsButton">Fetch formats</button>
      <p>Video id: <span id="videoIdDisplay"></span></p>
      <p>Video formats: <span id="videoFormatsDisplay"></span></p>
    </div>
  </body>
</html>
